<div class="page-container">
  <mat-card *ngIf="!isLoading; else loadingSpinner">
    <mat-card-title>Robo-Advisor Settings</mat-card-title>
    <mat-card-subtitle>
      Configure your automated investment agent. When active, it will automatically invest your wallet funds into new loans on the marketplace that match your criteria.
    </mat-card-subtitle>

    <mat-card-content>
      <form [formGroup]="strategyForm" (ngSubmit)="onSubmit()">
        
        <!-- Activation Toggle -->
        <mat-slide-toggle formControlName="active" color="primary" class="activation-toggle">
          Activate Robo-Advisor
        </mat-slide-toggle>

        <mat-divider></mat-divider>

        <!-- Investment Criteria -->
        <h3>Investment Rules</h3>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Max Investment per Loan</mat-label>
          <span matPrefix>$ &nbsp;</span>
          <input matInput type="number" formControlName="maxInvestmentPerLoan" required>
          <mat-hint>The most the agent will invest in a single loan opportunity.</mat-hint>
        </mat-form-field>

        <div class="checkbox-group" formGroupName="riskScores">
          <label class="mat-label">Acceptable Risk Scores</label>
          <mat-checkbox formControlName="A" color="primary">A (Low Risk)</mat-checkbox>
          <mat-checkbox formControlName="B" color="primary">B (Medium Risk)</mat-checkbox>
          <mat-checkbox formControlName="C" color="warn">C (High Risk)</mat-checkbox>
        </div>

        <mat-divider></mat-divider>

        <!-- Optional Filters -->
        <h3>Optional Filters</h3>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Minimum Interest Rate (APR)</mat-label>
          <span matSuffix>%</span>
          <input matInput type="number" formControlName="minInterestRate">
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Maximum Loan Term (Months)</mat-label>
          <input matInput type="number" formControlName="maxLoanTerm">
        </mat-form-field>

        <mat-card-actions align="end">
          <button mat-flat-button color="primary" type="submit" [disabled]="strategyForm.invalid || isSaving || !strategyForm.dirty">
            <span *ngIf="!isSaving">Save Strategy</span>
            <span *ngIf="isSaving">Saving...</span>
          </button>
        </mat-card-actions>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Loading Spinner Template -->
  <ng-template #loadingSpinner>
    <div class="spinner-container">
      <mat-spinner></mat-spinner>
    </div>
  </ng-template>
</div>